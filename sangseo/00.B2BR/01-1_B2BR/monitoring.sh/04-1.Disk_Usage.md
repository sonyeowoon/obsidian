# df 명령
파일 시스템의 디스크공간에 대한 정보를 보고합니다.
B2BR에서 사용한 `df -BM`에서 옵션에 대한 설명은 아래와 같습니다.
> [!abstract] note
**-B, --block-size=<크기>**
내용 출력 전 <크기>만큼 크기를 단위 맞춤.
예: '-BM'은 1,048,576 바이트 를 출력합니다.
<크기> 인자는 정수값과 추가 단위로 구성합니다 (예: 10K는 10\*1024).
단위는 K,M,G,T,P,E,Z,Y (1024 배수) 또는 KB,MB,... (1000 배수) 입니다.
이진 접미사의 경우 마찬가지입니다. KiB=K, MiB=M, 등과 같습니다.
***

Disk_Usage에서 구현해야 하는 내용은 아래와 같습니다.
![[00.born2beroot_번역#^862cfc]]

Disk Usage를 구현하기 위한 과정을 단계별로 살펴봅니다.
# df -BM
일단 Disk Usage를 정확히 받아오기 위해 MB 단위로 받습니다.
```
df -BM
```
![[Pasted image 20240413100419.png]]
받아온 정보는 위와 같습니다.

# grep
grep 을 통해서 실제로 사용중인 /dev/mapper 디렉토리의 내용들만 가져와볼 것입니다.
```
df -BM | grep /deb/mapper
```
![[Pasted image 20240413100437.png]]

# awk 명령
awk를 통해서 특정 열만 가져올 것입니다.
```
awk '{total+=$2}{printf"%d\n", total}'
```
grep에 해당되는 행들만큼 마치 C언어의 while문처럼 돌게되며 total에 자동으로 저장될 것입니다. 아래 사진을 보면 쉽게 이해가 가능합니다.
![[Pasted image 20240413101228.png]]
grep으로부터 받아낸 값들을 awk로 파이프 전달을 하여
파티션별 디스크의 전체 크기를 더한 값이 마지막에 나왔습니다.
받은 값들을 `total+=`를 통해 계속 덧셈을 하며 증가시킨 모습입니다.
## awk(2)
위 사진에서는 덧셈을 할 때마다 계속 출력되는 모습을 보입니다.
awk관련 많은 문법들은 내용이 길어서 [링크](https://inpa.tistory.com/entry/LINUX-%F0%9F%93%9A-awk-%EB%AA%85%EB%A0%B9%EC%96%B4-%EB%AC%B8%EB%B2%95-%EB%A7%88%EC%8A%A4%ED%84%B0-%F0%9F%92%AF-%EC%B4%9D%EC%A0%95%EB%A6%AC)로 대체하고 지금은 END 패턴을 사용합니다.
**END패턴은 모든 레코드를 처리한 다음 END"~"에 지정된 액션을 실행합니다.**
```
awk '{total+=$2}END{printf"%d\n", total}'
```
![[Pasted image 20240413101609.png]]
while문처럼 받은 값들을 더해주고 마지막에 END패턴에 지정된 값을 출력한 모습입니다.
## awk(3)
그럼 total은 구했는데 useage는 어떻게 구할까?
```
awk '{total+=$2; use+=$3}END{printf"%d/%dMB (%.f%%)\n", use, total, use/total*100}'
```
위처럼 해주면 된다. 쉼표를 통해 나눠주고 새로운 변수를 만들어낼 수 있다.
그리고 printf문법도 C언어의 pritnf처럼 맞춰가는 모습니다.
float소수점은 `%.f`로 표현이 가능한데, 만약 `%.2f`로 적게된다면 소수점 둘째자리인 17.25와 같이 나타낼 것이다.
![[Pasted image 20240413104328.png]]

