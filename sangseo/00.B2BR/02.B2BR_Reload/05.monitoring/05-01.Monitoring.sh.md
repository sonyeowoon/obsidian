monitoring.sh라는 쉘 스크립트를 통해서 10분마다 쉘 스크립트를 실행할 것입니다.
pdf의 원문은 아래와 같습니다.
![[00.born2beroot_번역#Monitoring.sh]]
***

# Architecture
![[00.born2beroot_번역#^b5578c]]
# CPU physical
![[00.born2beroot_번역#^9f78af]]

# vCPU
![[00.born2beroot_번역#^990e60]]

# Memory Usage
![[00.born2beroot_번역#^848f4c]]
# Disk Usage
![[00.born2beroot_번역#^09b42d]]
# CPU load
![[00.born2beroot_번역#^8c0963]]
# Last boot
![[00.born2beroot_번역#^66ba48]]
# LVM use
![[00.born2beroot_번역#^7f63d6]]
# Connections
![[00.born2beroot_번역#^96b284]]
# User log
![[00.born2beroot_번역#^979df6]]
# Network
![[00.born2beroot_번역#^90d3fa]]
# Sudo
![[00.born2beroot_번역#^ab6d98]]
완성본은 아래와 같습니다.
```
# Architecture
printf "#Architecture: "
uname -a

# CPU physical
grep "physical id" /proc/cpuinfo | sort -u | wc -l | awk '{printf"#CPU physical : %d\n", $1}'

# vCPU
printf "#vCPU : "
grep -c processor /proc/cpuinfo

# Memory Usage
FREE_TOTAL=`free -m | grep Mem | awk '{print $2}'`
FREE_USED=`free -m | grep Mem | awk '{print $3}'`
echo $FREE_USED $FREE_TOTAL | awk '{printf("#Memory Usage: %d/%dMB (%.2f%%)\n", $1, $2, $1/$2*100)}'

# Disk Usage
df -BM | grep /dev/mapp | awk '{total+=$2; use+=$3}END{printf"#Disk Usage: %d/%dMB (%.f%%)\n", use, total, use/total*100}'

# CPU Load
mpstat | sed -n '4,$p' | awk '{printf"#CPU load: %.1f%%\n", 100-$13 }'

# Last boot
last reboot --time-format=iso | sed -n '1,1p' | awk '{printf"#Last boot: %s\n", $5}' | tr 'T' ' ' | cut -c 1-28 

# Lvm use
printf "#LVM use: "
ACTIVE=`sudo lvs | awk '{printf"%s\n", $3}' | sed -n '2,$p' | cut -c 5-5 | sort -u | grep a | wc -l`

if [ ${ACTIVE} -eq 1 ] ; then
	echo "yes"
else
	echo "no"
fi

# Connections TCP(active connections)
ss -t | grep ESTAB | wc -l | awk '{printf"#Connections TCP : %d ESTABLISHED\n", $1}'

# User log
who -u | wc -l | awk '{printf"#User log: %d\n", $1}'

# ipv4
ifconfig | grep -e "inet" -e "ether" | sed -ne '1p' | awk '{printf"#Network: IP %s", $2}'
ifconfig | grep -e "inet" -e "ether" | sed -ne '3p' | awk '{printf" (%s)\n", $2}'

# sudo_log
COUNT_SUDO_LOG=`ls -l /var/log/sudo/00/00/ | sed -n '2,$p' | wc -l`
printf "#Sudo : $COUNT_SUDO_LOG cmd\n"
```
[[05-02.Architecture]]
